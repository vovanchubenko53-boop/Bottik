
proDream
13 –∏—é–Ω—å 2024, 11:50
AIOgram3 18. –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ–ø–ª–∞—Ç—É Telegram Stars
Python

6 –∏—é–Ω—è –ü–∞–≤–µ–ª –î—É—Ä–æ–≤ —Å–æ–æ–±—â–∏–ª, —á—Ç–æ –≤ Telegram –≤–≤–æ–¥–∏—Ç—Å—è –Ω–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ ‚Äî Stars. Stars –ø–æ–∑–≤–æ–ª—è—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –ø–æ–∫—É–ø–∫—É —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥, –ø—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è, –æ–ø–ª–∞—á–∏–≤–∞—Ç—å –ø–æ–∫—É–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ Telegram, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –±–æ—Ç–∞—Ö –∏–ª–∏ –≤ MiniApps. –û–¥–Ω–∞–∫–æ –Ω–µ –≤—Å—ë —Ç–∞–∫ —Ä–∞–¥—É–∂–Ω–æ. –í–≤–µ–¥–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã –≤–ª–µ—á—ë—Ç –∑–∞ —Å–æ–±–æ–π –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤. –ï—Å–ª–∏ –≤–∞—à –±–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–ª –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ –Æ–ö–∞—Å—Å—É, —Ç–æ —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ "–ó–≤—ë–∑–¥—ã". –ü—Ä–∏—á–∏–Ω—ã —Ç–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ—Å—Ç–∞–≤–∏–º –∑–∞ —Å–∫–æ–±–∫–∞–º–∏ –∏ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏–º—Å—è –Ω–∞ –±–æ–ª–µ–µ –≤–∞–∂–Ω—ã—Ö –≤–µ—â–∞—Ö, –∞ –∏–º–µ–Ω–Ω–æ –Ω–∞ —Ç–æ–º, –∫–∞–∫ –≤–Ω–µ–¥—Ä–∏—Ç—å –≤ Telegram-–±–æ—Ç–∞ –Ω–æ–≤—ã–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã ‚Äî Telegram Stars.

–ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –∑–≤—ë–∑–¥—ã –º–æ–∂–Ω–æ, –æ—Ç–∫—Ä—ã–≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –∏ –Ω–∞–π–¥—è –ø—É–Ω–∫—Ç "–ó–≤—ë–∑–¥—ã Telegram".


–°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å. –ù–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è –Ω–µ –±—ã–ª–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–π –ø–æ —Ç–æ–º—É, –∫–∞–∫ –∏ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–≤—ë–∑–¥—ã. –°—Ç–∞—Ç—å—è –±—É–¥–µ—Ç –¥–æ–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç Telegram. –ï—Å–ª–∏ –≤–∞–º —á—Ç–æ-—Ç–æ –∏–∑–≤–µ—Å—Ç–Ω–æ, —Å–æ–æ–±—â–∏—Ç–µ –Ω–∞–º!

–í–Ω–∏–º–∞–Ω–∏–µ! –ü–æ—Å—Ç —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º —Å–µ—Ä–∏–∏ "Telegram-–±–æ—Ç –Ω–∞ AIOgram3".

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è AIOgram 3.7.0. –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É:

pip install -U aiogram
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é –≤ —Ñ–∞–π–ª–µ requirements.txt.

aiogram==3.7.0
–ö–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã
–ü–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –º—ã –Ω–∞—á–Ω—ë–º –ø–∏—Å–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã, –≤—ã—Å—Ç–∞–≤–ª—è—é—â–µ–π —Å—á—ë—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è –æ–ø–ª–∞—Ç—ã, –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –æ—Ç–∫—Ä–æ–µ—Ç –æ–∫–Ω–æ –¥–ª—è –æ–ø–ª–∞—Ç—ã.

–í –ø–∞–∫–µ—Ç–µ botlogic —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –ø–∞–∫–µ—Ç keyboards, –∞ –≤ –Ω—ë–º —Ñ–∞–π–ª payment_keyboard.py.

–ü—Ä–æ–ø–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é payment_keyboard, –∫–æ—Ç–æ—Ä–∞—è –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç.

–í —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–¥–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é builder, –≤ –∫–æ—Ç–æ—Ä–æ–π –æ–ø—Ä–µ–¥–µ–ª–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ InlineKeyboardBuilder.

–í –Ω–µ–≥–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –∫–ª–∞—Å—Å–∞ –∫–Ω–æ–ø–∫–∏, –Ω–æ —ç—Ç–æ –Ω–µ —Å–æ–≤—Å–µ–º —É–¥–æ–±–Ω–æ, –ø—Ä–æ—â–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–µ—Ç–æ–¥–∞–º–∏ –∫–ª–∞—Å—Å–∞. –ù–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–µ –≤—ã–∑—ã–≤–∞–µ–º —É –æ–±—ä–µ–∫—Ç–∞ –∫–ª–∞—Å—Å–∞ –º–µ—Ç–æ–¥ .button, –¥–æ–±–∞–≤–ª—è—é—â–∏–π –∫–Ω–æ–ø–∫—É –≤ —Å–±–æ—Ä—â–∏–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã. –ü–µ—Ä–µ–¥–∞—ë–º –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞:

text ‚Äî –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ. –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –±—É–¥–µ—Ç XTR –∏–ª–∏ —ç–º–æ–¥–∑–∏ –∑–≤–µ–∑–¥—ã ‚≠êÔ∏è, –æ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω–∏—Ç—Å—è –Ω–∞ –∏–∫–æ–Ω–∫—É Telegram Stars.

pay ‚Äî –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –∫–Ω–æ–ø–∫–∏ –∫–∞–∫ –∫–Ω–æ–ø–∫—É –¥–ª—è –æ–ø–ª–∞—Ç—ã.

–î–∞–ª–µ–µ –¥–µ–ª–∞–µ–º –≤–æ–∑–≤—Ä–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π builder, –ø—Ä–∏–º–µ–Ω–∏–≤ –∫ –Ω–µ–π –º–µ—Ç–æ–¥ .as_markup, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç –≥–æ—Ç–æ–≤–æ–π –∫ —Ä–∞–∑–º–µ—â–µ–Ω–∏—é –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.

–ö–æ–¥ —Ñ–∞–π–ª–∞:
from aiogram.utils.keyboard import InlineKeyboardBuilder  
  
  
def payment_keyboard():  
    builder = InlineKeyboardBuilder()  
    builder.button(text=f"–û–ø–ª–∞—Ç–∏—Ç—å 20 ‚≠êÔ∏è", pay=True)  
  
    return builder.as_markup()
–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å—á—ë—Ç –º–æ–∂–Ω–æ –∏ –±–µ–∑ –Ω–µ—ë. –û–¥–Ω–∞–∫–æ, –æ–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏, –∞ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏, —Ç–∞–∫–∏–µ, –∫–∞–∫ –æ—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–∞, –≤—ã–±–æ—Ä –¥—Ä—É–≥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –∏ —Ç.–¥.

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á—ë—Ç–∞
–ü—Ä–∏—Å—Ç—É–ø–∏–º –∫ –Ω–∞–ø–∏—Å–∞–Ω–∏—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã.

–í –ø–∞–∫–µ—Ç–µ handlers —Å–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª payment.py.

–í —ç—Ç–æ–º —Ñ–∞–π–ª–µ –ø—Ä–æ–ø–∏—à–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é send_invoice_handler, –ø—Ä–∏–Ω–∏–º–∞—é—â—É—é message ‚Äî –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ Message.

–°–æ–∑–¥–∞–¥–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é prices, –≤ –∫–æ—Ç–æ—Ä—É—é –ø–æ–º–µ—Å—Ç–∏–º —Å–ø–∏—Å–æ–∫ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –∫–ª–∞—Å—Å–∞ LabeledPrice, –≤–µ—Ä–Ω–µ–µ, —Å –æ–¥–Ω–∏–º –æ–±—ä–µ–∫—Ç–æ–º, —Ç–∞–∫ –∫–∞–∫ –¥–ª—è –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Telegram Stars —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞. –í –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ –ø–µ—Ä–µ–¥–∞—ë–º —Å–ª–µ–¥—É—é—â–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:

label ‚Äî –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ XTR.

amount ‚Äî –°—Ç–æ–∏–º–æ—Å—Ç—å –≤ –∑–≤—ë–∑–¥–∞—Ö.

–î–∞–ª–µ–µ —É –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π message –≤—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ .answer_invoice, —á—Ç–æ–±—ã –±–æ—Ç –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–Ω–æ–ø–∫–æ–π —Å–æ —Å—á—ë—Ç–æ–º –Ω–∞ –æ–ø–ª–∞—Ç—É. –í –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–¥–∞—ë–º —Å–ª–µ–¥—É—é—â–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:

title ‚Äî –ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞, —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏.

description ‚Äî –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞, —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏.

prices ‚Äî –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ LabeledPrice, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ä–∞–Ω–µ–µ –≤ –æ–¥–Ω–æ–∏–º—ë–Ω–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

provider_token ‚Äî –¢–æ–∫–µ–Ω –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –¥–ª—è Telegram Stars –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É.

payload ‚Äî –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –ø–ª–∞—Ç–µ–∂–∞. –û–Ω–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∞ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –∏—Ö —Ç–∏–ø–∞–º –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –ú–∞–∫—Å–∏–º—É–º 128 –±–∞–π—Ç –¥–∞–Ω–Ω—ã—Ö (–≤ Python –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª –∑–∞–Ω–∏–º–∞–µ—Ç –æ–¥–∏–Ω –±–∞–π—Ç, –Ω–æ —Å—Ç–æ–∏—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏–ª–∏ —ç–º–æ–¥–∑–∏ –º–æ–≥—É—Ç –∑–∞–Ω–∏–º–∞—Ç—å –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞).

currency ‚Äî –í–∞–ª—é—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞, –¥–ª—è Telegram Stars —ç—Ç–æ XTR.

reply_markup ‚Äî –û–±—ä–µ–∫—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.

–ö–æ–¥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞:
from aiogram.types import LabeledPrice, Message  
  
from botlogic.keyboards.payment_keyboard import payment_keyboard  
  
  
async def send_invoice_handler(message: Message):  
    prices = [LabeledPrice(label="XTR", amount=20)]  
    await message.answer_invoice(  
        title="–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–Ω–∞–ª–∞",  
        description="–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∫–∞–Ω–∞–ª –Ω–∞ 20 –∑–≤—ë–∑–¥!",  
        prices=prices,  
        provider_token="",  
        payload="channel_support",  
        currency="XTR",  
        reply_markup=payment_keyboard(),  
    )
–ü—Ä–µ–¥–ø—Ä–æ–¥–∞–∂–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–°—á—ë—Ç –≤—ã—Å—Ç–∞–≤–ª–µ–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å". –ï—Å–ª–∏ —É –Ω–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–≤—ë–∑–¥, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –∏—Ö –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏. –ï—Å–ª–∏ –∑–≤—ë–∑–¥ —É –Ω–µ–≥–æ —Ö–≤–∞—Ç–∞–µ—Ç, –æ–Ω –ø—Ä–æ–∏–∑–≤–µ–¥—ë—Ç –æ–ø–ª–∞—Ç—É, –∏ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç Telegram –ø—Ä–∏—à–ª—ë—Ç –≤ –±–æ—Ç–∞ –∑–∞–ø—Ä–æ—Å "—Ç–æ—á–Ω–æ –ª–∏ –≤—Å—ë —Ö–æ—Ä–æ—à–æ?". –ù–∞ –æ—Ç–≤–µ—Ç —É –Ω–∞—Å –±—É–¥–µ—Ç —Ä–æ–≤–Ω–æ 10 —Å–µ–∫—É–Ω–¥. –ï—Å–ª–∏ –º—ã –ø–æ –∫–∞–∫–∏–º-—Ç–æ –ø—Ä–∏—á–∏–Ω–∞–º –Ω–µ —Ö–æ—Ç–∏–º –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–ø–ª–∞—Ç—ã —É –¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –æ—Ç–º–µ–Ω—É –ø–ª–∞—Ç–µ–∂–∞, –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–∞—Ç—å –æ—Ç–≤–µ—Ç, —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π –æ–± –æ—Ç–º–µ–Ω–µ –ø–ª–∞—Ç–µ–∂–∞, —Å–æ–ø—Ä–æ–≤–æ–¥–∏–≤ –µ–≥–æ –ø—Ä–∏—á–∏–Ω–æ–π –æ—Ç–º–µ–Ω—ã. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º –∂–µ —Å–ª—É—á–∞–µ, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º, —á—Ç–æ –≤—Å—ë "–û–∫".

–í —ç—Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ —Å–æ–∑–¥–∞–¥–∏–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é pre_checkout_handler, –ø—Ä–∏–Ω–∏–º–∞—é—â—É—é –∞—Ä–≥—É–º–µ–Ω—Ç pre_checkout_query ‚Äî –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ PreCheckoutQuery.

–í —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π pre_checkout_query –≤—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ .answer, –ø–µ—Ä–µ–¥–∞–≤–∞—è –≤ –Ω–µ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç ok —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º True.

–ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏:
from aiogram.types import PreCheckoutQuery


async def pre_checkout_handler(pre_checkout_query: PreCheckoutQuery):  
    await pre_checkout_query.answer(ok=True)
–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ –ø–æ–∫—É–ø–∫–µ
–ë—é—Ä–æ–∫—Ä–∞—Ç–∏—è –ø–æ–∑–∞–¥–∏, –æ—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –ø–æ–∑–¥—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–∫—É–ø–∫–æ–π!

–í —ç—Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ —Å–æ–∑–¥–∞–¥–∏–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é success_payment_handler, –ø—Ä–∏–Ω–∏–º–∞—é—â—É—é –∞—Ä–≥—É–º–µ–Ω—Ç message ‚Äî –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ Message.

–í –æ–±—ä–µ–∫—Ç–µ –∫–ª–∞—Å—Å–∞ Message —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏, –∞ –≤ –ø–æ–ª–µ successful_payment –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ, —Ç–∞–∫–∞—è, –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞, —Å—É–º–º–∞, –≤–∞–ª—é—Ç–∞, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø–æ–ª—É—á–µ–Ω–Ω–∞—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ-—Ö–æ—Ä–æ—à–µ–º—É, —ç—Ç–æ –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –ø–ª–∞—Ç–µ–∂–∞–º –≤ –±—É–¥—É—â–µ–º.

–í —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–ª–∞–µ–º –æ–±—ã—á–Ω—ã–π –æ—Ç–≤–µ—Ç, —Å–æ–æ–±—â–∞—è, —á—Ç–æ –ø–æ–∫—É–ø–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.

–ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏:
async def success_payment_handler(message: Message):  
    await message.answer(text="ü•≥–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É –ø–æ–¥–¥–µ—Ä–∂–∫—É!ü§ó")
–ö–æ–º–∞–Ω–¥–∞ paysupport –∏ –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤
Telegram —Ç–∞–∫–∂–µ –ø—Ä–µ–¥—ä—è–≤–ª—è–µ—Ç —É—Å–ª–æ–≤–∏—è –∫ –≤–æ–∑–≤—Ä–∞—Ç—É —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º. –ù–µ –∑–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏ —É—Å–ª—É–≥–∏ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤, –æ–¥–Ω–∞–∫–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤, –ª–∏–±–æ –±—ã—Ç—å –ø—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–∞—Å–∞—Ç–µ–ª—å–Ω–æ —ç—Ç–æ–≥–æ.

–î–ª—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–º–∞–Ω–¥–∞ /paysupport. –í –Ω–µ–π –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —É—Å–ª–æ–≤–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞, –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –¥—Ä. –î–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º —ç—Ç—É –∫–æ–º–∞–Ω–¥—É.

–°–æ–∑–¥–∞–¥–∏–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é pay_support_handler, –ø—Ä–∏–Ω–∏–º–∞—é—â—É—é message ‚Äî –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ Message. –í —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–ø–∏—à–µ–º –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–º —É—Å–ª–æ–≤–∏—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤.

–ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏:
async def pay_support_handler(message: Message):  
    await message.answer(  
        text="–î–æ–±—Ä–æ–≤–æ–ª—å–Ω—ã–µ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è –Ω–µ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞—é—Ç –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤, "  
        "–æ–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ –≤—ã –æ—á–µ–Ω—å —Ö–æ—Ç–∏—Ç–µ –≤–µ—Ä–Ω—É—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ - —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏."    )
–ù–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã –≤–æ–∑–≤—Ä–∞—Ç–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º, –æ–±—Ä–∞—â–∞—è—Å—å –∫ –º–µ—Ç–æ–¥—É .refund_star_payment —É –æ–±—ä–µ–∫—Ç–∞ Bot, –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –Ω–µ–≥–æ user_id –∏ telegram_payment_charge_id.

user_id ‚Äî Telegram-ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤.

telegram_payment_charge_id ‚Äî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞, —Å–æ–≤–µ—Ä—à—ë–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
–í—Å—ë –≥–æ—Ç–æ–≤–æ, –æ—Å—Ç–∞–ª–æ—Å—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ main.py.

–û—Ç–∫—Ä–æ–µ–º —Ñ–∞–π–ª main.py –∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ start –¥–æ–±–∞–≤–∏–º —á–µ—Ç—ã—Ä–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

send_invoice_handler ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —É–∫–∞–∑–∞–≤ —Ñ–∏–ª—å—Ç—Ä –∫–æ–º–∞–Ω–¥—ã donate.

pre_checkout_handler ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–∞–∫ —Å–æ–±—ã—Ç–∏–µ pre_checkout_query.

success_payment_handler ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –í –∫–∞—á–µ—Å—Ç–≤–µ —Ñ–∏–ª—å—Ç—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã–π "–ú–∞–≥–∏—á–µ—Å–∫–∏–π —Ñ–∏–ª—å—Ç—Ä F", –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π —Å–æ–±–æ–π –æ–±—ä–µ–∫—Ç Message. –í —Ñ–∏–ª—å—Ç—Ä–µ –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–æ–ª—é successful_payment. –ï—Å–ª–∏ –æ–Ω–æ –Ω–µ –ø—É—Å—Ç–æ–µ (—É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞), –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.

pay_support_handler ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –Ω–∞ –∫–æ–º–∞–Ω–¥—É paysupport.

from aiogram import F


dp.message.register(payment.send_invoice_handler, Command(commands="donate"))
dp.pre_checkout_query.register(payment.pre_checkout_handler)
dp.message.register(payment.success_payment_handler, F.successful_payment)
dp.message.register(payment.pay_support_handler, Command(commands="paysupport"))
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ó–∞–ø—É—Å—Ç–∏–º –±–æ—Ç–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏–º –∫–æ–º–∞–Ω–¥—É /donate.


–ü–æ–ª—É—á–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–ª–∞—Ç–µ–∂–µ –∏ –∫–Ω–æ–ø–∫–æ–π-—Å—á—ë—Ç–æ–º. –ù–∞–∂–º—ë–º –Ω–∞ –∫–Ω–æ–ø–∫—É.

–û—Ç–∫—Ä–æ–µ—Ç—Å—è –æ–∫–Ω–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –æ–ø–ª–∞—Ç—ã (–µ—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –∑–≤—ë–∑–¥ ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –æ–∫–Ω–æ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∏—è, –∫–∞–∫ –Ω–∞ –ø–µ—Ä–≤–æ–º —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –≤ –Ω–∞—á–∞–ª–µ –ø–æ—Å—Ç–∞). –ù–∞–∂–∏–º–∞–µ–º "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –∑–∞–ø–ª–∞—Ç–∏—Ç—å".


–í —á–∞—Ç–µ –≤—ã—Å—Ç—Ä–µ–ª–∏—Ç –∫–æ–Ω—Ñ–µ—Ç—Ç–∏, –∏ –º—ã —É–≤–∏–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –ø–ª–∞—Ç–µ–∂–µ.


–ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–ù–æ–≤–æ–≤–≤–µ–¥–µ–Ω–∏–µ, –∫–æ–Ω–µ—á–Ω–æ, –≤—Å–µ—Ö —É–¥–∏–≤–∏–ª–æ –∏ –Ω–µ–º–Ω–æ–≥–æ –∑–∞—Å—Ç–∞–ª–æ –≤—Ä–∞—Å–ø–ª–æ—Ö. –ù–∞ –ø–µ—Ä–µ—Ö–æ–¥ –¥–∞–ª–∏ –º–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏, –∏ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ –Ω–µ –≤—Å–µ –¥–∞–∂–µ —É–∑–Ω–∞–ª–∏ –æ–± —ç—Ç–æ–º. –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ –±—É–¥–µ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫ —á–µ–º—É –≤—Å—ë —ç—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç.

–ß–∏—Ç–∞—Ç—å –ø–æ—Å—Ç –Ω–∞ —Å–∞–π—Ç–µ.
–ß–∏—Ç–∞—Ç—å –ø–æ—Å—Ç –≤ Telegram.

–¢–µ–≥–∏:
telegram, aiogram, telegram stars, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
–•–∞–±—ã:
Python
15
–ö–∞—Ä–º–∞
13
–†–µ–π—Ç–∏–Ω–≥
–ò–≤–∞–Ω @proDream
–ê–≤—Ç–æ—Ä ¬´–ö–æ–¥ –Ω–∞ —Å–∞–ª—Ñ–µ—Ç–∫–µ¬ª, —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä –∏ –ø–∏—Ç–æ–Ω–∏—Å—Ç

–ü–æ—Ö–æ–∂–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
–õ—É—á—à–∏–µ –∑–∞ —Å—É—Ç–∫–∏
–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è
¬© 2006‚Äì2025 ¬´Habr¬ª